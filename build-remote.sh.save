


 #!/bin/sh

dcos package uninstall rabbitmq
dcos job run clean-rabbitmq
#dcos package install --options=config-etc.json --yes etcd
set -e

shellcheck src/main/docker/rabbitmq-wrapper.sh

DESTBOX=192.168.100.26

PROJECT=`basename ${PWD}`
rsync -avl --exclude "build" --exclude ".gradle" ../${PROJECT} ${DESTBOX}:
ssh ${DESTBOX} "cd ${PROJECT} && ./build-clem.sh" | tee /tmp/build-rmq
ssh ${DESTBOX} "cd ${PROJECT} && ./gradlew dockerPushImage"
REPO_URL=$(egrep ^http /tmp/build-rmq)

dcos package repo remove rabbitmq-aws
dcos package repo add --index=0 rabbitmq-aws ${REPO_URL}
dcos package install --yes rabbitmq

cat > test_me.md << EOF
You can test this framework, based on my latest successful build
```bash
$ dcos package repo remove rabbitmq-aws
$ dcos package repo add --index=0 rabbitmq-aws ${REPO_URL}
$ dcos package install --yes rabbitmq
```
EOF
